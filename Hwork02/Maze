#include<iostream>
#include<cstdio>
#include<cstring> 


using namespace std ;

typedef enum { Copy = -1, Right, Down, Left, Up } Moves ;

class CoXY {
	
	int y ;
	int x ;
	
	public:
		
	CoXY(): y(0), x(0) {
	} ;
		
	CoXY( int py, int px ){
		y = py ;
		x = px ;
	} // CoXY
	
	void setXY( const int py, const int px ) {
		y = py ;
		x = px ;
	}
	
	int getX() const {
		return x ;
	}
	int getY() const {
		return y ;
	}
	
	CoXY nextXY( Moves dir ) const {
	
		CoXY pt( y, x ) ;
		switch( dir ) {
			
			case Right: 
				pt.x++ ;
				break ;
			case Down:
				pt.y-- ;
				break ;
			case Left:
				pt.x-- ;
				break ;
			case Up:
				pt.y++ ;
				break ;
			default:
				;
				
		} // switch
		
		return pt ;
	
	} // nextXY
	
	bool match( const CoXY &pt ) {
		
		if ( y == pt.y && x == pt.x )
			return true ;
		
		return false ;	
		
	} // match()
	
	bool inRange( const CoXY &maxLimit ) {
		
		if ( y >= 0 && y < maxLimit.y && x >= 0 && x < maxLimit.x )
			return true ;
			
		return false ;
		
	} // inRange
	
}; // class CoXY

class Maze {
			
	char **mArray ;
	char **mArrayR ;
	
	CoXY coMax ;
	
	public:
		
	bool Load( string fileName ) ;
	
	void Print() ;
	void PrintR() ;
	
	bool SolveMaze( CoXY pt, int &numGoal ) ;
	
}; // class Maze

void Maze::Print() {
	
	for ( int i = 0 ; i < coMax.getY() ; i++ ){
		for( int j = 0 ; j < coMax.getX() ; j++ )
			cout << mArray[i][j] ;
			
		cout << "\n" ;
	} // for
	
} // Print

void Maze::PrintR() {
	
	for ( int i = 0 ; i < coMax.getY() ; i++ ){
		for( int j = 0 ; j < coMax.getX() ; j++ )
			cout << mArrayR[i][j] ;
			
		cout << "\n" ;
	} // for
	
} // Print

bool Maze::Load( string fileName ){
	
	FILE *infile = NULL ;
	bool success = false ;
	coMax.setXY(0, 0) ;
	
	fileName = "input" + fileName + ".txt" ;
	infile = fopen(fileName.c_str(), "r") ;
	if ( infile == NULL )
		;
	else{
		
		int arg1 = 0, arg2 = 0 ;
		fscanf( infile, "%d %d", &arg1, &arg2 ) ;
		coMax.setXY( arg2, arg1 ) ;
		if ( coMax.getY() > 0 && coMax.getX() > 0 ){
			
			int line = 0 ;
			char *temp = new char[coMax.getX() + 1] ;
			mArray = new char *[coMax.getY()] ;
			mArrayR = new char *[coMax.getY()] ;
			
			while( fscanf( infile, "%s", temp ) != EOF ){
		
				mArray[line] = new char [coMax.getX() + 1] ;
				mArrayR[line] = new char [coMax.getX() + 1] ;
				strcpy( mArray[line], temp ) ;
				strcpy( mArrayR[line++], temp ) ;
				
			} // while
			
			if ( line == coMax.getY() ) {
				success = true ;
			} // if
				
		} // if
		
		fclose( infile ) ;	
		
	} // else
	
	return success ;
	
} // Load()

bool Maze::SolveMaze( CoXY pt, int &numGoal ) {
	
	if ( !pt.inRange( coMax ) )
		return false ;
	else if ( mArray[pt.getY()][pt.getX()] == 'G' ) {
		
		cout << "It's G!\n" ;
		numGoal-- ;
			
		mArray[pt.getY()][pt.getX()] = 'V' ;
		
		if ( numGoal > 0 ) 	
			SolveMaze( pt.nextXY( Right ), numGoal ) ;
		if ( numGoal > 0 ) 
			SolveMaze( pt.nextXY( Down ), numGoal ) ;
		if ( numGoal > 0 ) 
			SolveMaze( pt.nextXY( Left ), numGoal ) ;
		if ( numGoal > 0 ) 
			SolveMaze( pt.nextXY( Up ), numGoal ) ;
			
		mArray[pt.getY()][pt.getX()] = 'G' ;
				
			
		return true ;
		
	} // else if
	else if ( mArray[pt.getY()][pt.getX()] == 'E' ) {
		
		mArray[pt.getY()][pt.getX()] = 'V' ;
		bool success = false ;
		
		if ( numGoal > 0 )
			if ( SolveMaze( pt.nextXY( Right ), numGoal ) ) {
				mArrayR[pt.getY()][pt.getX()] = 'R' ; 
				success = true ;
			} // if
		if ( numGoal > 0 )
			if ( SolveMaze( pt.nextXY( Down ), numGoal ) ) {
				mArrayR[pt.getY()][pt.getX()] = 'R' ; 
				success = true ;
			} // if
		if ( numGoal > 0 )
			if ( SolveMaze( pt.nextXY( Left ), numGoal ) ) {
				mArrayR[pt.getY()][pt.getX()] = 'R' ; 
				success = true ;
			} // if
		if ( numGoal > 0 )
			if ( SolveMaze( pt.nextXY( Up ), numGoal ) ) {
				mArrayR[pt.getY()][pt.getX()] = 'R' ; 
				success = true ;
			} // if
			
		return success ;
		
	} // else if
	else
		return false ;
	
} // SolveMaze

int main() {
	
	Maze maze ;
	int cmd = -1 ;
	cout << "(1)One Goal\n(2)More Goals\n(0)Exit\nChoose a command: " ;
	cin >> cmd ;
	while ( cmd != 0 ) {
	
		string fileName ;
		cout << "要讀哪個檔: " ;
		cin >> fileName ; 
		while ( !maze.Load( fileName ) ) {
			cout << "Not working, try again: " ;
			cin >> fileName ;
		} // while
	
		int numGoal = 1 ;
		if ( cmd == 2 ) {
			cout << "要找幾個Goal: " ;
			cin >> numGoal ;
		} // if
	
		CoXY pt(0, 0) ;
	
		if ( maze.SolveMaze( pt, numGoal ) ) {
			maze.Print() ;
			cout << "\n" ;
			maze.PrintR() ;
			cout << "Success\n\n" ;
		} // if
		else { 
			maze.Print() ;
			cout << "Fail\n\n" ;
		} // else 
		
		cout << "(1)One Goal\n(2)More Goals\n(0)Exit\nChoose a command: " ;
		cin >> cmd ; 
	
	} // while
	
} // main
